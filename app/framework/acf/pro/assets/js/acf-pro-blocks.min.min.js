"use strict";function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function a(b){return typeof b}:function a(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b})(a)}function _get(a,b,c){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function a(g,j,f){var h=_superPropBase(g,j);if(h){var d=Object.getOwnPropertyDescriptor(h,j);return d.get?d.get.call(f):d.value}})(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&null!==(a=_getPrototypeOf(a));){}return a}function ownKeys(a,c){var d=Object.keys(a);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(a);c&&(b=b.filter((function(f){return Object.getOwnPropertyDescriptor(a,f).enumerable}))),d.push.apply(d,b)}return d}function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?ownKeys(c,!0).forEach((function(d){_defineProperty(a,d,c[d])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):ownKeys(c).forEach((function(d){Object.defineProperty(a,d,Object.getOwnPropertyDescriptor(c,d))}))}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(a,c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1,b.configurable=!0,"value" in b&&(b.writable=!0),Object.defineProperty(a,b.key,b)}}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _possibleConstructorReturn(a,b){return !b||"object"!==_typeof(b)&&"function"!=typeof b?_assertThisInitialized(a):b}function _getPrototypeOf(a){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function a(b){return b.__proto__||Object.getPrototypeOf(b)})(a)}function _assertThisInitialized(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function _inherits(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return(_setPrototypeOf=Object.setPrototypeOf||function a(c,d){return c.__proto__=d,c})(a,b)}!function(C,x){function k(){var a=acf.get("blockTypes");a&&a.map(b)}function b(c){var f=c.post_types||[],l;if(f.length){f.push("wp_block");var d=acf.screen.getPostType();if(-1===f.indexOf(d)){return !1}}if("string"==typeof c.icon&&"<svg"===c.icon.substr(0,4)){var h=c.icon;c.icon=React.createElement(B,{html:h})}c.icon||delete c.icon,wp.blocks.getCategories().filter((function(i){return i.slug===c.category})).pop()||(console.warn('The block "'.concat(c.name,'" is registered with an unknown category "').concat(c.category,'".')),c.category="common"),c=acf.parseArgs(c,{title:"",name:"",category:"",attributes:{id:{type:"string"},name:{type:"string"},data:{type:"object"},align:{type:"string"},mode:{type:"string"}},edit:function c(i){return React.createElement(m,i)},save:function c(){return null}}),D[c.name]=c;var a=wp.blocks.registerBlockType(c.name,c);return a.attributes.anchor&&(a.attributes.anchor={type:"string"}),a}function j(a){return D[a]||!1}function q(a){for(var d=(wp.data.select("core/block-editor")||wp.data.select("core/editor")).getBlocks(),f=0;f<d.length;){d=d.concat(d[f].innerBlocks),f++}for(var c in a){d=d.filter((function(h){return h.attributes[c]===a[c]}))}return d}function A(a,c){return C.ajax({url:acf.get("ajaxurl"),dataType:"json",type:"post",cache:!1,data:acf.prepareForAjax({action:"acf/ajax/fetch-block",block:JSON.stringify(a),query:c})})}function z(a){var d=[],f=a.nodeName.toLowerCase();for(var c in wp.editor){c.toLowerCase()===f&&(f=wp.editor[c])}return d[0]=f,d[1]={},[].slice.call(a.attributes).forEach((function(e){var i=e.name,h=e.value;i="class"===i?"className":i,d[1][i]=h})),[].slice.call(a.childNodes).forEach((function(e){if(e instanceof Text){var h=e.textContent.trim();h&&d.push(h)}else{d.push(z(e))}})),React.createElement.apply(this,d)}var D={};acf.addAction("ready",k),acf.parseJSX=function(a){return z(a[0])};var m=function(a){function c(d){var e;return _classCallCheck(this,c),(e=_possibleConstructorReturn(this,_getPrototypeOf(c).call(this,d))).setAttributes=e.setAttributes.bind(_assertThisInitialized(e)),e.setup(),e}return _inherits(c,a),_createClass(c,[{key:"setup",value:function a(){function o(e){-1===e.indexOf(f.mode)&&(f.mode=e[0])}var t=this.props,i=t.name,f=t.attributes,p=t.clientId,h=j(i),d;f.id?q().filter((function(e){return e.attributes.id===f.id})).filter((function(e){return e.clientId!==p})).pop()&&(f.id=acf.uniqid("block_")):(f.id=acf.uniqid("block_"),f.name=h.name,f.mode=f.mode||h.mode,f.align=f.align||h.align,f.data=f.data||h.data);"edit"===h.mode?o(["edit","preview"]):"preview"===h.mode?o(["preview","edit"]):o(["auto"])}},{key:"setAttributes",value:function a(d){this.props.setAttributes(d)}},{key:"render",value:function a(){function Q(){R({mode:"preview"===F?"edit":"preview"})}var I=this.props,G=I.name,M=I.attributes,T=I.isSelected,R=I.setAttributes,F=M.mode,K=j(G),E=wp.element.Fragment,H=wp.blockEditor||wp.editor,P=H.BlockControls,h=H.InspectorControls,J=wp.components,S=J.Toolbar,t=J.IconButton,U=J.PanelBody,N=J.Button,L=K.supports.mode;"auto"===F&&(L=!1);var o="preview"===F?acf.__("Switch to Edit"):acf.__("Switch to Preview"),d="preview"===F?"edit":"welcome-view-site";return React.createElement(E,null,React.createElement(P,null,L&&React.createElement(S,null,React.createElement(t,{className:"components-icon-button components-toolbar__control",label:o,icon:d,onClick:Q}))),React.createElement(h,null,React.createElement("div",{className:"acf-block-component acf-block-panel"},React.createElement("div",{className:"acf-block-panel-actions"}),"preview"===F&&React.createElement(y,this.props))),React.createElement("div",{className:"acf-block-component acf-block-body"},"auto"===F&&T?React.createElement(y,this.props):"auto"!==F||T?"preview"===F?React.createElement(v,this.props):React.createElement(y,this.props):React.createElement(v,this.props)))}}]),c}(React.Component),B=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,_getPrototypeOf(c).apply(this,arguments))}return _inherits(c,a),_createClass(c,[{key:"render",value:function a(){return React.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.html}})}}]),c}(React.Component),g={},w=function(c){function d(f){var h;return _classCallCheck(this,d),(h=_possibleConstructorReturn(this,_getPrototypeOf(d).call(this,f))).setup(f),h.data=h.getData({html:"",$el:!1,init:!1}),h}return _inherits(d,c),_createClass(d,[{key:"setup",value:function a(f){this.id=""}},{key:"getData",value:function a(f){return g[this.id]||f}},{key:"setData",value:function a(f){this.data=g[this.id]=_objectSpread({},this.data,{},f)}},{key:"setHtml",value:function c(h){var e;if((h=h.trim())!==this.datahtml){var f=a(h);this.setData((_defineProperty(e={html:h,$el:f},"$el",f),_defineProperty(e,"init",!1),e)),this.display()}}},{key:"render",value:function a(){var i=this,p=wp.components,h=p.Placeholder,l=p.Spinner;return React.createElement("div",{ref:function f(e){return i.el=e}},React.createElement(h,null,React.createElement(l,null)))}},{key:"display",value:function c(){a(this.el).html(this.data.$el),this.data.init?this.componentDidRemount():(this.setData({init:!0}),this.componentDidInitialize()),this.componentDidRender()}},{key:"componentDidMount",value:function a(){var f=!!this.data.$el;this.props.reusableBlock&&(f=!1),f?this.display():this.fetch()}},{key:"componentDidInitialize",value:function a(){acf.doAction("append",this.data.$el)}},{key:"componentWillUnmount",value:function a(){acf.doAction("unmount",this.data.$el)}},{key:"componentDidRemount",value:function a(){var f=this;setTimeout((function(){acf.doAction("remount",f.data.$el)}))}},{key:"componentDidRender",value:function a(){}},{key:"fetch",value:function a(){}}]),d}(React.Component),y=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,_getPrototypeOf(c).apply(this,arguments))}return _inherits(c,a),_createClass(c,[{key:"setup",value:function a(d){this.id="BlockForm-".concat(d.attributes.id)}},{key:"fetch",value:function a(){var d=this,f;A(this.props.attributes,{form:!0}).done((function(e){d.setHtml(e.data.form)}))}},{key:"componentDidInitialize",value:function a(){function h(i){var p=arguments.length>0&&i!==x&&i,o=acf.serialize(n,"acf-".concat(e.id));p?e.data=o:d({data:o})}_get(_getPrototypeOf(c.prototype),"componentDidInitialize",this).call(this);var l=this.props,e=l.attributes,d=l.setAttributes,n=this.data.$el,f=!1;n.on("change keyup",(function(){clearTimeout(f),f=setTimeout(h,300)})),e.data||h(!0)}}]),c}(w),v=function(a){function c(){return _classCallCheck(this,c),_possibleConstructorReturn(this,_getPrototypeOf(c).apply(this,arguments))}return _inherits(c,a),_createClass(c,[{key:"setup",value:function a(d){this.id="BlockPreview-".concat(d.attributes.id)}},{key:"fetch",value:function a(){var d=this,f=this.props.attributes;this.setData({attributes:f}),A(f,{preview:!0}).done((function(e){d.setHtml(e.data.preview)}))}},{key:"componentDidUpdate",value:function a(f){var h,d;JSON.stringify(f.attributes)!==JSON.stringify(this.props.attributes)&&this.fetch()}},{key:"componentDidInitialize",value:function a(){_get(_getPrototypeOf(c.prototype),"componentDidInitialize",this).call(this);var e=this.props.attributes,d=e.name.replace("acf/","");acf.doAction("render_block_preview",this.data.$el,e),acf.doAction("render_block_preview/type=".concat(d),this.data.$el,e)}},{key:"componentDidRemount",value:function a(){var e,d;_get(_getPrototypeOf(c.prototype),"componentDidRemount",this).call(this),JSON.stringify(this.data.attributes)!==JSON.stringify(this.props.attributes)&&this.fetch()}}]),c}(w)}(jQuery);